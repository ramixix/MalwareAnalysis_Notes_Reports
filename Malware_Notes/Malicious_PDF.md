## PDF File Format 
- Portable Format Document (it is a file that was created for the reason that you would open it anywhere easily.)
- Text-based structure, PDF files usually contain non-Ascii data (like streams, images, videos, scripts, links...)
- Uses streams to store data and hierarchical structure
- 4 main parts:
	- Header
	- The body
	- Cross-reference table
	- Trailer

The File Signature for PDF files is : %PDF-<version>. ex :

```vim
00000000: 2550 4446 2d31 2e36 0a25 c3a4 c3bc c3b6  %PDF-1.6.%......
00000010: c39f 0a25 2525 2525 2525 2525 2525 2525  ...%%%%%%%%%%%%%
00000020: 2525 2525 2525 2525 2525 2525 2525 2525  %%%%%%%%%%%%%%%%
00000030: 2525 2525 2525 2525 2525 2525 2525 2525  %%%%%%%%%%%%%%%%
```

### Info Body
**Basically in PDF file every piece of information is inside an object.** Objects can have different types. some objects :

- **Streams** - Enclosed between "==stream ...data... endstream=="
- **Arrays** - Enclosed with square brackets  ex : [a b c]
- **Dictionaries** - Indexed by names, enclosed within double angle brackets << ... >>
- **Names** - Starting with forward slash ex: /Producer 
- **Strings** - Enclosed within parentheses (...) or as hex within single angle brackets <...>
- **Objects** - Enclosed between "==x y obj ...data... endobj==". For example "1 0 obj ... endobj". The first number is the number of the object, the second number is version. 
	- Reference another object (5 0 R) - As mentioned the PDF file has a hierarchal structure so one object can reference another object 

Example : 

![[mal_pdf_analysis.png]]

1. As we can see above the object 11 starts at first line with "11 0 obj" and ends with "endobj".
2. The stream started with "stream" and ended with "endstream" keywords  and we can see some data inside that object (4). **Streams and information in PDF files can be compressed , to save space. This can also help thread actors because it makes the text less readable. There are many different ways to compress the data.**
3. The "/Filter" name in dictionary specify that the data is going to be compressed and "/FlateDecode" specify how. 


### Info Trailer
When a PDF file is being read by a PDF reader it will start from the bottom. It will go to the end of the file and read the last line ( **%%EOF** ), then it will go one line above and read that line which is the offset of **xref** table. and above that we have the **Trailer**. Above Trailer we have the xref table itself. Example :

![[mal_pdf_analysis1.png]]

#### Trailer 
The trailer has important information that each PDF reader will need to know at start of reading the PDF file. 
- **/Size n** -  Number of objects in that PDF file
- **/Root n n R** - Where is the root object
- **/Info n n R** - Where is information about the PDF file

#### Xref Table
This table also is important for PDF readers because this table, shows the offset of each object in PDF file. That is how PDF reader can identify different objects without reading the whole PDF file.

---
### How PDF files can be dangerous ?
1. They might contain Malicious Links and sites.
2. PDF files can contain JavaScript code, so adversaries can write JavaScript code that is malicious.
3. streams and other malicious files can be embedded inside the PDF file
4. The PDF readers used by users can itself contain some bugs, that can be exploited by attackers.

---
### Tools to use :
- peepdf.py - you can use it to get information about pdf file, use "-f" flag to ignore any error. It is actually the only tool that you need because it has a interactive shell and to get a interactive shell use "-i" flag. then you can use "help" to see what you can do.
- pdf-parser.py - it can do the same thing as peepdf only non-interactive. "-f" for filter. "-o" for objects. "-d" to dump to object to a file.
- pdfid : give info about pdf.