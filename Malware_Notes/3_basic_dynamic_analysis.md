# Basic Dynamic Analysis
(Dynamic analysis also known as heuristic analysis or behavioral analysis)
**Overview:**
<iframe width="560" height="315" src="https://www.youtube.com/embed/OzuSFQ48y9Q" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

Dynamic analysis is any examination performed after executing malware. Dynamic analysis is typically performed after basic static analysis has reached a dead end, whether due to obfuscation, packing, or the analyst having exhausted the available static analysis techniques. It can involve monitoring malware as it runs or examining the system after the malware has executed.


The majority of malware you will encounter are EXEs and DLLs. Although you’ll usually find it simple enough to run executable malware by double-clicking the executable or running the file from the command line, it can be tricky to launch malicious DLLs because Windows doesn’t know how to run them automatically. Let’s take a look at how you can launch DLLs to be successful in performing dynamic analysis.

> The program rundll32.exe is included with all modern versions of Windows. It provides a container for running a DLL using this syntax:

![[3_0.png]]

The Export value must be a function name or ordinal selected from the exported function table in the DLL. As you learned in [[2.0_basic_static_techniques]], you can use a tool such as PEview or PE Explorer to view the Export table.


Malware can also have functions that are exported by ordinal—that is, as an exported function with only an ordinal number. In this case, you can still call those functions with rundll32.exe using the following command, where 5 is the ordinal number that you want to call, prepended with the # character:

![[3_1.png]]

Because malicious DLLs frequently run most of their code in DLLMain (called from the DLL entry point), and because DLLMain is executed whenever the DLL is loaded, you can often get information dynamically by forcing the DLL to load using rundll32.exe.
Alternatively, you can even turn a DLL into an executable by modifying the PE header and changing its extension to force Windows to load the DLL as it would an executable. 
To modify the PE header, wipe the IMAGE_FILE_DLL (0x2000) flag from the Characteristics field in the IMAGE_FILE_HEADER. While this change won’t run any imported functions, it will run the DLLMain method, and it may cause the malware to crash or terminate unexpectedly. However, as long as your changes cause the malware to execute its malicious payload, and you can collect information for your analysis, the rest doesn’t matter.


DLL malware may also need to be installed as a service, sometimes with a convenient export such as InstallService, as listed in ipr32x.dll:

![[3_2.png]]

The ServiceName argument must be provided to the malware so it can be installed and run. The net start command is used to start a service on a Windows system.

> NOTE : When you see a ServiceMain function without a convenient exported function such as Install or InstallService, you may need to install the service manually. You can do this by using the Windows sc command or by modifying the registry for an unused service, and then using net start on that service. The service entries are located in the registry at "HKLM\SYSTEM\CurrentControlSet\Services."


## TOOLS : Procman, Processe explorer, Regshot

> procmon : Process Monitor, or procmon, is an advanced monitoring tool for Windows that provides a way to monitor certain registry, file system, network, process, and thread activity. It combines and enhances the functionality of two legacy tools: FileMon and RegMon.
<iframe width="560" height="315" src="https://www.youtube.com/embed/UL1msF9-bnk" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

> The Process Explorer: You can use Process Explorer to list active processes, DLLs loaded by a process, various process properties, and overall system information. You can also use it to kill a process, log out users, and launch and validate processes

<iframe width="560" height="315" src="https://www.youtube.com/embed/y2bNLCWHFNs" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

> regshot : Regshot is an open source registry comparison tool that allows you to take and compare two registry snap-shots.

<iframe width="560" height="315" src="https://www.youtube.com/embed/kCT7ZQW-Cb4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>


**User ApateDNS to fake a dns server for malwares and redirect them to where ever you want. You can use ApateDns to see what domain does a malware want to resolve and you can use Netcat, wireshark, INetSim and other tools to capture the packets and analyzing them. **

**Chap3 lab:**
<iframe width="560" height="315" src="https://www.youtube.com/embed/pIH2JMDkIzc" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
